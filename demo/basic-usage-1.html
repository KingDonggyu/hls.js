<html>
  <head>
    <title>Hls.js demo - basic usage</title>
  </head>

  <body>
    <script src="../dist/hls.js"></script>

    <center>
      <h1>Hls.js demo - basic usage</h1>
      <video height="600" id="video" controls></video>
    </center>

    <script>
      const STORAGE_KEYS = {
        Hls_Config: 'hlsjs:config',
        volume: 'hlsjs:volume',
      };
      function getPersistedHlsConfig() {
        let value = localStorage.getItem(STORAGE_KEYS.Hls_Config);
        if (value === null) {
          return value;
        }
        try {
          value = JSON.parse(value);
        } catch (e) {
          console.warn('[getPersistedHlsConfig] could not hls config json', e);
        }
        return value;
      }
      function getURLParam(sParam, defaultValue) {
        const sPageURL = self.location.search.substring(1);
        const sURLVariables = sPageURL.split('&');
        for (let i = 0; i < sURLVariables.length; i++) {
          const sParameterName = sURLVariables[i].split('=');
          if (sParameterName[0] === sParam) {
            return sParameterName[1] === 'undefined'
              ? undefined
              : sParameterName[1] === 'false'
                ? false
                : sParameterName[1];
          }
        }
        return defaultValue;
      }
      const sourceURL = decodeURIComponent(
        getURLParam(
          'src',
          'https://stream.mux.com/v69RSHhFelSm4701snP22dYz2jICy4E4FUyk02rW4gxRM.m3u8'
        )
      );
      const video = document.getElementById('video');
      const volumeSettings = JSON.parse(
        localStorage.getItem(STORAGE_KEYS.volume)
      ) || {
        volume: 0.05,
        muted: false,
      };
      video.volume = volumeSettings.volume;
      video.muted = volumeSettings.muted;
      if (Hls.isSupported()) {
        const config = getPersistedHlsConfig() || {
          debug: false,
          enableWorker: false,
          lowLatencyMode: true,
          backBufferLength: 9999999999,
          maxBufferLength: 9999999999,
          testBandwidth: false,
          stretchShortVideoTrack: false,
          capLevelOnFPSDrop: true,
          fpsDroppedMonitoringPeriod: 1000,
          fpsDroppedMonitoringThreshold: 0.25,
          maxLiveSyncPlaybackRate: 1,
          liveSyncDuration: null,
          maxBufferHole: 0,
          maxFragLookUpTolerance: 0,
        };
        const hls = (window.hls = new Hls(config));
        hls.loadSource(sourceURL);
        hls.attachMedia(video);
        // hls.on(Hls.Events.MEDIA_ATTACHED, function () {
        //   video.muted = true;
        //   video.play();
        // });
      }
      // hls.js is not supported on platforms that do not have Media Source Extensions (MSE) enabled.
      // When the browser has built-in HLS support (check using `canPlayType`), we can provide an HLS manifest (i.e. .m3u8 URL) directly to the video element through the `src` property.
      // This is using the built-in support of the plain video element, without using hls.js.
      else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = sourceURL;
      }
      video.addEventListener('canplay', function () {
        video.play();
      });
    </script>
  </body>
</html>
